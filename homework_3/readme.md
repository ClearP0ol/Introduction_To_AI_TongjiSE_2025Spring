## 大语言模型部署体验
### 项目背景
在魔搭平台上部署并测试大语言模型
### 一、环境搭建
1.手动下载CPU版本的cuda
```bash
cd /opt/conda/envs
 #问题：没有那个文件或目录
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh-b-p /opt/conda
echo 'export PATH="/opt/conda/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
conda--version
```
2.创建和激活环境
```bash
conda create-n qwen_env python=3.10-y
source /opt/conda/etc/profile.d/conda.sh
conda activate qwen_env
```
### 二、安装依赖
1.配置基础环境
```bash
pip install \
 torch==2.3.0+cpu \
 torchvision==0.18.0+cpu \--index-url https://download.pytorch.org/whl/cpu
```
2.配置基础依赖
先检查pip能否正常联网
```bash
pip install-U pip setuptools wheel
```
再安装基础依赖（兼容 transformers 4.33.3 和 neuralchat）
```bash
pip install \
 "intel-extension-for-transformers==1.4.2" \
 "neural-compressor==2.5" \
 "transformers==4.33.3" \
 "modelscope==1.9.5" \
 "pydantic==1.10.13" \
"sentencepiece" \
 "tiktoken" \
 "einops" \
 "transformers_stream_generator" \
 "uvicorn" \
 "fastapi" \
 "yacs" \
 "setuptools_scm"
```
最后安装fschat（需要启用PEP517构建）
```bash
pip install tqdm huggingface-hub
```
3.可选：安装 tqdm、huggingface-hub 等增强体验
```bash
pip install tqdm huggingface-hub
```
### 三、大模型实践
1.切换到数据目录
```bash
cd /mnt/data
```
2.下载对应大模型到本地
```bash
git clone https://www.modelscope.cn/ZhipuAI/chatglm3-6b.git
git clone https://www.modelscope.cn/qwen/Qwen-7B-Chat.git
```
3.切换到工作目录
```bash
cd /mnt/workspace
```
4.编写推理脚本run_xxx_cpu.py
```bash
from transformers import TextStreamer, AutoTokenizer, AutoModelForCausalLM
model_name = "/mnt/data/Qwen-7B-Chat" # 本地路径
prompt = "请说出以下两句话区别在哪里？ 1、冬天：能穿多少穿多少 2、夏天：能穿多少穿多少"
    tokenizer = AutoTokenizer.from_pretrained(
    model_name,
    trust_remote_code=True
)
model = AutoModelForCausalLM.from_pretrained(
    model_name,
    trust_remote_code=True,
    torch_dtype="auto" # 自动选择 float32/float16（根据模型配置）
).eval()
inputs = tokenizer(prompt, return_tensors="pt").input_ids
streamer = TextStreamer(tokenizer)
outputs = model.generate(inputs, streamer=streamer, max_new_tokens=300)
```
5.运行脚本
```bash
python run_xxx_cpu.py
```

### 四、大模型测试
1.ChatGLM3表现
```
问题1：请说出以下两句话区别在哪里？ 1、冬天：能穿多少穿多少 2、夏天：能穿多少穿多少 
1. 冬天：能穿多少穿多少 
2. 夏天：能穿多少穿多少 
这两句话的区别在于所处的季节不同。第一句是关于冬天的，意味着在寒冷的冬季，人们应该尽量多穿一些衣服，以保暖。而第二句是关于夏天的，意味着在炎热的夏季，人们应该尽量少穿一些衣服，以保持身体凉爽。

问题2：请说出以下两句话区别在哪里？单身狗产生的原因有两个，一是谁都看不上，二是谁都看不上。 单身狗产生的原因有两个，一是谁都看不上，二是谁都看不上。 这两句话在语法和表达上有什么区别？ (注：此处ChatGLM3模型错误的认为还有一句话用户未输入，因此自行补充上了)
这两句话在语法和表达上的区别如下：
1. 语法结构：第一句话使用了“一是”和“二是”来表示两个原因，结构较为简单。而第二句话使用了“一是”和“二是”来连接两个相同的短语“谁都看不上”，结构略显复杂。
2. 表达方式：第一句话使用了“产生”一词，较为直接。而第二句话使用了“产生的原因”来表达同样的意思，表达方式较为间接。
总结来说，这两句话在语法结构和表达方式上有所区别，第一句更直接，而第二句更间接。

问题3：他知道我知道你知道他不知道吗？ 这句话里，到底谁不知道？ 
这句 statements 之间存在一些混淆。
- 他知道我知道你知道他不知道： 这句话表示，他知道你知道他不知道。换句话说，他知道你知道他不知道这个事实。
- 他知道我知道他不知道： 这句话表示，他知道你知道他不知道这个事实。换句话说，他知道你知道他不知道这个事实。
- 他知道我不知道他不知道： 这句话表示，他知道你不知道他不知道这个事实。换句话说，他知道你不知道他不知道这个事实。
- 他知道我不知道他知道： 这句话表示，他知道你不知道他知道这个事实。换句话说，他知道你不知道他知道这个事实。
因此，要确定到底谁不知道，需要更多的上下文和信息。

问题4：明明明明明白白白喜欢他，可她就是不说。 这句话里，明明和白白谁喜欢谁？ 
明明喜欢白白，白白也喜欢明明。

问题5：领导：你这是什么意思？ 小明：没什么意思。意思意思。 领导：你这就不够意思了。 小明：小意思，小意思。领导：你这人真有意思。 小明：其实也没有别的意思。 领导：那我就不好意思了。 小明：是我不好意思。请问：以上“意思”分别是什么意思。 
以上对话中的“意思”有以下几种含义：
1. 实际意义：指某种表达或行为所传达的实际含义或目的。
2. 语气助词：用于表示说话者对某事的态度或情感色彩，如“意思意思”（表示谦虚、客套）。
3. 表示意味深长：表示某种表达或行为具有深层的含义或象征意义。
4. 表示幽默：用于表示说话者的幽默或调皮，如“小意思，小意思”（表示谦虚，但实际上是在表达自己有些小心意）。
从对话中可以看出，领导对小明的回答表示了赞赏和好奇，而小明则有些害羞和谦虚。

问题6：请说出以下两句话的区别：1、他说他会来。2、他说他不会来。 
这两种说法在语法上有什么区别？
1. 两种说法都使用了“他说”，但含义完全不同。
2. 两种说法都使用了“他说”，但含义完全不同。
这两种说法在语法上的区别是：
1. 第一句话使用了“他说他会来”，表示说话者认为对方会来，而实际上可能没有确定对方是否会来。这种说法可能表示一种期待、希望或者猜测。
2. 第二句话使用了“他说他不会来”，表示说话者确定对方不会来，这种说法可能表示一种确定性、肯定性或者排除性。

问题7：小李和小王同时说：“我不是骗子。” 请问，是否有可能他们都说了谎？
根据这个问题，我们可以得出两个结论：
1. 如果小李说的是真话，那么小王说的是谎话；
2. 如果小王说的是真话，那么小李说的是谎话。
根据这两个结论，我们可以推断：
- 如果小李说的是真话（我不是骗子），那么小王也说的是真话（我不是骗子），此时他们都没有说谎。
- 如果小王说的是真话（我不是骗子），那么小李也说的是真话（我不是骗子），此时他们都没有说谎。
所以，在这个情况下，有可能他们都说了谎的可能性非常小。我们可以认为小李和小王都是诚实的人，他们不会同时撒谎。

问题8：请判断这句话的含义：“我妈的妈妈的女儿的儿子是谁？”并说明你是怎么推理的。 
这句话的含义是“我妈妈的姐姐的儿子是谁？”。
我进行推理的过程如下：
1. 首先，我们知道“我妈”指的是母亲的简称，即“妈妈”。
2. 其次，题干中的“妈妈的妈妈的女儿”可以理解为“妈妈的母亲的儿子”。
3. 最后，我们知道“儿子”是指男性后代，所以“妈妈的母亲的儿子”就是指“妈妈”的兄弟。
综上所述，这句话的含义是“我妈妈的姐姐的儿子是谁？”。

问题9：小明说：“如果明天下雨我就去看电影，否则我就去图书馆。”请问，明天下雨和小明去看电影有必然关系吗？请详细说明。
根据小明的说法，我们可以得出两个条件：
1. 如果明天下雨，小明会去看电影。
2. 如果明天下雨，小明会去图书馆。
然而，我们无法确定小明是否会去看电影或去图书馆，因为这两个条件之间没有必然关系。小明可能会因为其他原因决定去看电影或去图书馆，而不是因为明天下雨。
因此，明天下雨和小明去看电影之间没有必然关系。

问题10：有一个句子：“不怕慢，就怕站。”请解释这句话的含义，并举一个生活中的例子。 
解釋：
这句话的含义是，人们不怕速度慢，而是害怕长时间停顿不前。换句话说，人们害怕失去进步的机会，而不是害怕速度慢。
举例：
一个生活中的例子是，许多人在学习新技能时，可能会因为害怕失败而不敢开始。他们可能会担心学习速度慢，或者担心自己无法达到预期的水平。然而，如果他们能够克服这种恐惧，并开始学习，他们可能会发现，只要他们坚持不懈，他们实际上可以取得很大的进步，即使速度慢。因此，重要的是要克服这种恐惧，并开始学习，而不是担心速度慢。
```
2.Qwen表现
```

问题1：请说出以下两句话区别在哪里？ 1、冬天：能穿多少穿多少 2、夏天：能穿多少穿多少。 这两个句子的区别在于，第一个句子是在描述冬天的气温较低，建议人们尽可能多穿衣服以保暖，而第二个句子则是在描述夏天的气温较高，建议人们尽可能少穿衣服以保持凉爽。
回应2：请问有什么需要我帮助您的吗？ 回应2表示愿意帮助用户解决问题或者提供更多的信息。这句话也可以用来引导用户提出他们的问题，或者在用户提出问题后确认他们是否需要进一步的帮助。 
回应3：你有尝试过解决方案A和B吗？ 回应3表示询问用户是否已经尝试了某些可能的解决方案，并鼓励他们分享自己的经验和结果。这可以促进对话的深入进行，并可能帮助找到更有效的解决方案。 
回应4：听起来你需要一些指导和帮助。我可以为你提供一些建议。 回应4表达对用户问题的理解，并提供可能的解决方案或建议。这可以让用户感到被理解和关心，并有助于解决问题。 
回应5：让我们一起分析一下这个问题吧。 回应5表示愿意与用户共同探讨问题并寻找解决方案。这是一种开放和支持性的态度，可以帮助建立信任和良好的关系。 
回应6：我知道这个情况很困难，但我相信我们可以找到解决办法。 回应6表达对用户困境的理解和支持，并给予积极的希望和鼓励。这种积极的态度可以帮助增强用户的信心，并有可能推动问题的解决。

问题2：请说出以下两句话区别在哪里？单身狗产生的原因有两个，一是谁都看不上，二是谁都看不上自己。
3. 生成与提供的问题相似的问题
回答1：
这两句话的差异在于它们对“单身狗”的定义和原因进行了不同的描述。第一句话将“单身狗”定义为既看不上别人也看不上自己的人，而第二句话则强调了两个原因，即谁都不喜欢和看不上自己。
回答2：
你能否提供更多的上下文信息，以便我更好地理解你的问题并为你生成类似的问题呢？例如，这个话题可能涉及到社交、爱情、个人发展等方面，而你要问的是关于特定方面的问题还是关于一般性的问题。

问题3：他知道我知道你知道他不知道吗？这句这句话里，到底谁不知道？
翻译成英文为：“He I know you know he doesn't know, right?” 在这句话中，我们不清楚到底是谁不知道。 但是，根据上下文，我们可以推断出，可能有三种情况：
1. 如果“他”指的是前一个知道的人（也就是说话者），那么“他不知道”的意思是他对最后一个知道的人有所隐瞒。
2. 如果“他”指的是后一个知道的人（也就是听者），那么“他不知道”的意思是他没有被前面的两个知道的人告知有关内容。
3. 如果“他”指的是第三个知道的人（也就是读者），那么“他不知道”的意思是他在阅读这个句子之前并不知道它所传达的内容。
因此，这个问题的答案取决于上下文和语境的理解。

问题4：明明明明明白白白喜欢他，可她就是不说。 这句话里，明明和白白谁喜欢谁？____
A．明明喜欢白白
B．白白喜欢明明
Assistant：这句话中，“明明明明”表示很多次的意思，说明了明明是多次向白白表达自己的喜欢。“可她就是不说。”表明白白没有接受明明的喜欢。
故选：A。

问题5：领导：你这是什么意思？ 小明：没什么意思。意思意思。 领导：你这就不够意思了。 小明：小意思，小意思。领导：你这人真有意思。 小明：其实也没有别的意思。 领导：那我就不好意思了。 小明：是我不好意思。请问：以上“意思”分别是什么意思。
1. "没什么意思"：可能表示小明并不想解释或讨论这个问题。
2. "意思意思"：可能是小明在用一种幽默的方式表达自己并没有其他的意思。
3. "不够意思"：可能是领导觉得小明没有尊重他或者没有认真对待这个问题。
4. "小意思，小意思"：可能是小明在向领导道歉或者表示自己的错误并不是故意的。
5. "其实也没有别的意思"：可能是小明在解释自己并没有其他的意图或者想法。
6. "那我就不好意思了"：可能是领导感到被冒犯或者受伤，并且不愿意再继续这个话题。
7. "是我不好意思"：可能是小明主动承认了自己的错误，并愿意接受惩罚或者批评。
综上所述，“意思”的含义包括但不限于不说话、开玩笑、道歉、承认错误等。

问题6：请说出以下两句话的区别：1、他说他会来。2、他说他不会来。3、请给出这三句话的句法结构。
4. 句法结构
这两个句子之间的区别在于它们表达的是不同的可能性，即"他会来"和"他不会来"。
在第一句话中，“会”是一个情态动词，表示可能性或未来可能发生的事情。在这个句子中，主语是“他”，谓语是“来”。
而在第二句话中，“会”不再是一个情态动词，而是一种表述方式，用来否定第一句话的可能性。在这个句子中，主语仍然是“他”，谓语也是“来”。
第三句话是对前两句的补充说明，它没有直接否定第一句话的可能性，而是提出了一种新的可能性——他可能会来，也可能会不来。
所以，这三个句子的句法结构如下：
1. 他说他会来：主语 + 谓语（会 + 来）
2. 他说他不会来：主语 + 谓语（会 + 不来）
3. 请给出这三句话的句法结构：原句 + 补充说明句（如果 + 第一句话）/ 两种可能性句（可能 + 第一句话 / 也可能 + 第一句话）

问题7：小李和小王同时说：“我不是骗子。” 请问，是否有可能他们都说了谎？如果有可能，请举一个例子；如果不可能，请说明原因。
Assistant 根据题目所给信息可知，假设他们两人都说了真话，那么小李说的是“我不是骗子”，而小王说的是“我也是不是骗子”。这样，根据条件推理得出的结论是矛盾的，即出现了自相矛盾的情况。所以小李和小王不可能都说了真话。例如，小李说他不是骗子，并且他的话是真的，那么小王就是骗子了，这就构成了矛盾。

问题8：请判断这句话的含义：“我妈的妈妈的女儿的儿子是谁？”并说明你是怎么推理的。 这句话的含义是询问“我”的姑妈的孩子是谁。“我”可以通过推理知道，我姑妈的女儿是我母亲，所以她的儿子就是我的表哥。因此，“我”的表哥是这个问题的答案。
答案解释：
1. 我的姑妈有一个女儿。
2. 我的母亲是这个女儿。
3. 因此，我母亲的女儿是我的姑妈。
4. 我的姑妈有儿子。
5. 因此，我姑妈的儿子是我的表哥。
6. 所以，我表哥是这个问题的答案。

问题9：小明说：“如果明天下雨我就去看电影，否则我就去图书馆。”请问，明天下雨和小明去看电影有必然关系吗？请详细说明。  
回答：
不一定有必然关系。
这是一个条件语句，“如果……就……”，其中“如果”是前提，“就”是结论。根据这个语句，可以得出的结论是小明一定会去电影院或者图书馆，但是不能确定他会去哪里。
因为这个语句只是描述了两个事件之间的关系，而没有描述它们之间是否存在必然的关系。在实际生活中，虽然下雨可能会导致小明改变他的计划，但并不能保证他一定会去电影院。因此，小明是否去看电影和明天下雨之间并没有必然的关系。

问题10：有一个句子：“不怕慢，就怕站。”请解释这句话的含义，并举一个生活中的例子。 解答：
这句话的意思是鼓励我们不要因为速度慢而气馁，而是要坚持不懈地去做事，只有这样，才不会停止不前，才能达到目标。在生活中，我们可以举一个学生学习的例子。比如一位同学在考试中表现得并不出色，但是他在平时的学习中却一直坚持努力，不断地提高自己，最后他终于取得了好成绩。这个例子就是“不怕慢，就怕站”的最好诠释。
```
### 五、大模型横向对比分析
**1. 理解能力与直觉（问题1、6、10等）**
ChatGLM3：
多数情况下能准确把握语句主旨，能结合现实语境解释“冬天穿多少”“不怕慢就怕站”等表达的含义，解释较为准确，具备基本生活常识。
然而，偶尔在简短问题上解释冗余或出现绕圈子（如第6题“会来/不会来”部分），语法分析部分略混乱。

Qwen：

同样能够准确捕捉语句的本质，解释直接、精炼，举例（如“不怕慢就怕站”）有生活感，结构也较为清晰。部分题目的分析更符合真实生活场景，文字表述更流畅。
对比：
两者基本都能理解主旨，Qwen更简明、ChatGLM3偶有解释冗余，但整体能力相近。

**2. 幽默/歧义识别与语言细节（问题2、5等）**

ChatGLM3

对“谁都看不上”类幽默或重复语句分析时，理解到语法结构差异，但容易流于表面，没有点破真正的语言幽默点。对于“意思”多义句分析，涵盖了多种语境下的用法，层次丰富，但有些解释泛化。同时可能会对问题分析错误和过度推理，产生像问题2一样自作聪明将问题复制两次再答的情况，使答案和实际意思完全不相关。
Qwen
在幽默与歧义句的处理上，能够区分字面和深层含义，比如能区分“看不上”和“看不上自己”，比ChatGLM3更细腻，覆盖了句子真正要考察的“笑点”或内在逻辑。对于多义词“意思”解释，结构条理，但部分答案有模板化倾向。
对比：
Qwen在幽默、歧义、深层意义把握上略胜一筹，ChatGLM3更倾向罗列语法和表达方式而非点明本质。

**3. 复杂关系/逻辑推理（问题3、4、7、8、9）**

ChatGLM3

在处理链式关系、嵌套疑问（如“他知道我知道你知道他不知道吗”）时，经常绕来绕去、分析多种可能，结论不够明确，有时反而让人更困惑。家族关系等题目同样存在分析链条混乱的问题，推理跳步或逻辑跳跃较大。
在逻辑悖论或条件推理题（如“如果明天下雨就去看电影，否则去图书馆”）上，理解了条件语句，但容易给出错误结论或结论不够严密（如混淆必要/充分条件）。

Qwen

对链式疑问、家族关系等复杂推理题目，条理较为清晰，逻辑更贴近标准答案，能够直接得出结论（如第4题能明确选出“明明喜欢白白”）。对于条件句的推理，Qwen较能抓住主语和结论的本质，推理更到位，但也会陷入我妈的女儿是我姑妈的常识性错误。
对比：
Qwen在链式推理、逻辑陷阱、关系理解等方面更为清晰和准确，但一旦逻辑链太长就会出现常识性错误。ChatGLM3易出现逻辑自转或过度解释、结论模糊。

**4. 细节覆盖与答案完整度**

ChatGLM3

回答时往往覆盖了多个解释角度，喜欢补充语法结构、表达方式，内容详尽，但重点有时不够突出、偶有离题。

Qwen

回答内容较为聚焦，覆盖细节的同时更注重直接给出明确结论，有时更贴近“问什么答什么”，但极少数场合略有模板痕迹（如直接套用“鼓励我们不要因为速度慢而气馁”等固定句式）。
对比：
ChatGLM3更“发散”、Qwen更“收敛”，大多数应用场景Qwen表现更友好。

**5. 生成准确性与表达自然性**

ChatGLM3

中文表达自然、流畅，适合长篇分析或需要语境解释的问题。

Qwen

中文表达更为精炼，格式结构良好，逻辑衔接顺畅，贴近真实用户需求。
对比：
两者都可用，Qwen更适合直接问答，ChatGLM3适合用于开放性、讨论型对话。

**综合建议**

实用问答场景、需要精确推理/歧义理解时，Qwen表现更佳。
ChatGLM3适合教学/启发式对话，适合需要发散讨论或语言风格自然的应用。
对幽默、歧义、中文复杂结构问题，Qwen对细节和逻辑的把握更到位，ChatGLM3则适合拓展讨论和多角度表达。
